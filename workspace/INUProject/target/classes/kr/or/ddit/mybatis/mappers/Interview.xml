<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.board.dao.InterviewDAO">

	<sql id="searchFrag">
		<trim prefix="WHERE">
			<if test="simpleCondition neq null and @org.apache.commons.lang3.StringUtils@isNotBlank(simpleCondition.searchWord)">
				LOWER(INCUM_TITLE) LIKE '%' || #{simpleCondition.searchWord} || '%'
			</if>
			<if test="simpleCondition neq null and @org.apache.commons.lang3.StringUtils@isNotBlank(simpleCondition.searchWord)">
				OR LOWER(SUB_TITLE) LIKE '%' || #{simpleCondition.searchWord} || '%'
			</if>
			<if test="simpleCondition neq null and @org.apache.commons.lang3.StringUtils@isNotBlank(simpleCondition.searchWord)">
				OR LOWER(INCUM_NAME) LIKE '%' || #{simpleCondition.searchWord} || '%'
			</if>
			<if test="simpleCondition neq null and @org.apache.commons.lang3.StringUtils@isNotBlank(simpleCondition.searchWord)">
				OR LOWER(DEPARTMENT) LIKE '%' || #{simpleCondition.searchWord} || '%'
			</if>
			<if test="simpleCondition neq null and @org.apache.commons.lang3.StringUtils@isNotBlank(simpleCondition.searchWord)">
				OR LOWER(CMP_ID) LIKE '%' || #{simpleCondition.searchWord} || '%'
			</if>
		</trim>
	</sql>

	<select id="selectInterview" parameterType="String" resultType="kr.or.ddit.board.vo.InterviewVO">
		SELECT INCUM_NO,
			   CMP_ID,
			   DEPARTMENT,
			   INCUM_TITLE,
			   INCUM_NAME,
			   SUB_TITLE,
			   TO_CHAR(INCUM_DATE,'YYYY-MM-DD') INCUM_DATE,
			   INCUM_HITS,
			   TOP_TITLE,
			   INCUM_DEL_DATE,
			   QUESTION1,
			   ANSWER1,
			   QUESTION2,
			   ANSWER2,
			   QUESTION3,
			   ANSWER3,
			   QUESTION4,
			   ANSWER4,
			   QUESTION5,
			   ANSWER5,
			   QUESTION6,
			   ANSWER6,
			   QUESTION7,
			   ANSWER7,
			   QUESTION8,
			   ANSWER8,
			   QUESTION9,
			   ANSWER9,
			   QUESTION10,
			   ANSWER10
		  FROM INCUM_INTERVIEW
		 WHERE INCUM_NO = #{incumNo}
		   AND INCUM_DEL_DATE IS NULL
	</select>

	<select id="selectTotalRecord" parameterType="PagingVO" resultType="int">
		SELECT COUNT(*)
		  FROM INCUM_INTERVIEW
	<include refid="searchFrag"/>
	</select>

	<select id="selectInterviewList" resultType="kr.or.ddit.board.vo.InterviewVO">
          WITH ORDEREDINTERVIEW AS(
		SELECT INCUM_NO,
			   CMP_ID,
			   SUB_TITLE,
			   DEPARTMENT,
			   INCUM_TITLE,
			   JOB_SUB,
			   INCUM_NAME,
			   TO_CHAR(INCUM_DATE,'YYYY-MM-DD') INCUM_DATE,
			   INCUM_HITS
		  FROM (SELECT *
				  FROM INCUM_INTERVIEW
       			 WHERE INCUM_DEL_DATE IS NULL)
	<include refid="searchFrag"/>
	  ORDER BY INCUM_NO DESC
	  ) SELECT A.*
	      FROM (
	      	SELECT ROWNUM RNUM, ORDEREDINTERVIEW.*
	      	  FROM ORDEREDINTERVIEW
	      ) A
	      <where>
	      	<if test="_parameter neq null">
	      		RNUM BETWEEN #{startRow} AND #{endRow}
	      	</if>
	      </where>
	</select>

	<insert id="insertInterview" parameterType="InterviewVO">
		<selectKey order="BEFORE" resultType="String" keyProperty="incumNo">
			SELECT 'INT'||LPAD(INTERVIEW_SEQ.NEXTVAL, 6, 0)
			  FROM DUAL
		</selectKey>
		INSERT INTO INCUM_INTERVIEW(
			  INCUM_NO
			, CMP_ID
			, SUB_TITLE
			, DEPARTMENT
			, INCUM_TITLE
			, JOB_SUB
			, INCUM_NAME
			, INCUM_DATE
			, INCUM_HITS
			, TOP_TITLE
			, QUESTION1
			, ANSWER1
			, QUESTION2
			, ANSWER2
			, QUESTION3
			, ANSWER3
			, QUESTION4
			, ANSWER4
			, QUESTION5
			, ANSWER5
			, QUESTION6
			, ANSWER6
			, QUESTION7
			, ANSWER7
			, QUESTION8
			, ANSWER8
			, QUESTION9
			, ANSWER9
			, QUESTION10
			, ANSWER10
		)VALUES(
			  #{incumNo,jdbcType=VARCHAR}
			, #{cmpId,jdbcType=VARCHAR}
			, #{subTitle,jdbcType=VARCHAR}
			, #{department,jdbcType=VARCHAR}
			, #{incumTitle,jdbcType=VARCHAR}
			, #{jobSub,jdbcType=VARCHAR}
			, #{incumName,jdbcType=VARCHAR}
			, SYSDATE
			, 0
			, #{topTitle,jdbcType=VARCHAR}
			, #{question1,jdbcType=VARCHAR}
			, #{answer1,jdbcType=CLOB}
			, #{question2,jdbcType=VARCHAR}
			, #{answer2,jdbcType=CLOB}
			, #{question3,jdbcType=VARCHAR}
			, #{answer3,jdbcType=CLOB}
			, #{question4,jdbcType=VARCHAR}
			, #{answer4,jdbcType=CLOB}
			, #{question5,jdbcType=VARCHAR}
			, #{answer5,jdbcType=CLOB}
			, #{question6,jdbcType=VARCHAR}
			, #{answer6,jdbcType=CLOB}
			, #{question7,jdbcType=VARCHAR}
			, #{answer7,jdbcType=CLOB}
			, #{question8,jdbcType=VARCHAR}
			, #{answer8,jdbcType=CLOB}
			, #{question9,jdbcType=VARCHAR}
			, #{answer9,jdbcType=CLOB}
			, #{question10,jdbcType=VARCHAR}
			, #{answer10,jdbcType=CLOB}
		)
	</insert>

	<update id="updateInterview" parameterType="InterviewVO">
		UPDATE INCUM_INTERVIEW
		   SET
		        TOP_TITLE   = #{topTitle,jdbcType=VARCHAR}
			  , DEPARTMENT  = #{department,jdbcType=VARCHAR}
			  , INCUM_TITLE = #{incumTitle,jdbcType=VARCHAR}
			  , JOB_SUB     = #{jobSub,jdbcType=VARCHAR}
			  , INCUM_NAME  = #{incumName,jdbcType=VARCHAR}
			  , CMP_ID      = #{cmpId,jdbcType=VARCHAR}
			  , SUB_TITLE   = #{subTitle,jdbcType=VARCHAR}
			  , QUESTION1   = #{question1,jdbcType=VARCHAR}
			  , ANSWER1     = #{answer1,jdbcType=CLOB}
			  , QUESTION2   = #{question2,jdbcType=VARCHAR}
			  , ANSWER2     = #{answer2,jdbcType=CLOB}
			  , QUESTION3   = #{question3,jdbcType=VARCHAR}
			  , ANSWER3     = #{answer3,jdbcType=CLOB}
			  , QUESTION4   = #{question4,jdbcType=VARCHAR}
			  , ANSWER4     = #{answer4,jdbcType=CLOB}
			  , QUESTION5   = #{question5,jdbcType=VARCHAR}
			  , ANSWER5     = #{answer5,jdbcType=CLOB}
			  , QUESTION6   = #{question6,jdbcType=VARCHAR}
			  , ANSWER6     = #{answer6,jdbcType=CLOB}
			  , QUESTION7   = #{question7,jdbcType=VARCHAR}
			  , ANSWER7     = #{answer7,jdbcType=CLOB}
			  , QUESTION8   = #{question8,jdbcType=VARCHAR}
			  , ANSWER8     = #{answer8,jdbcType=CLOB}
			  , QUESTION9   = #{question9,jdbcType=VARCHAR}
			  , ANSWER9     = #{answer9,jdbcType=CLOB}
			  , QUESTION10  = #{question10,jdbcType=VARCHAR}
			  , ANSWER10    = #{answer10,jdbcType=CLOB}
		 WHERE INCUM_NO     = #{incumNo,jdbcType=VARCHAR}
	</update>

	<delete id="deleteInterview" parameterType="InterviewVO">
		UPDATE INCUM_INTERVIEW
		   SET INCUM_DEL_DATE = SYSDATE
		 WHERE INCUM_NO       = #{incumNo, jdbcType=VARCHAR}
	</delete>

	<update id="updateHits" parameterType="String">
		UPDATE INCUM_INTERVIEW
		   SET INCUM_HITS = INCUM_HITS+1
		 WHERE INCUM_NO   = #{incumNo, jdbcType=VARCHAR}
	</update>

</mapper>

