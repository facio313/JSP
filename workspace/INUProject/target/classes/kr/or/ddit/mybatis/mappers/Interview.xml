<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.board.dao.InterviewDAO">

	<sql id="searchFrag">
		<trim prefix="WHERE">
			<if test="simpleCondition neq null and @org.apache.commons.lang3.StringUtils@isNotBlank(simpleCondition.searchWord)">
				LOWER(INCUM_TITLE) LIKE '%' || #{simpleCondition.searchWord} || '%'
			</if>
			<if test="simpleCondition neq null and @org.apache.commons.lang3.StringUtils@isNotBlank(simpleCondition.searchWord)">
				OR LOWER(INCUM_CONTENT) LIKE '%' || #{simpleCondition.searchWord} || '%'
			</if>
			<if test="simpleCondition neq null and @org.apache.commons.lang3.StringUtils@isNotBlank(simpleCondition.searchWord)">
				OR LOWER(JOB_NAME) LIKE '%' || #{simpleCondition.searchWord} || '%'
			</if>
			<if test="simpleCondition neq null and @org.apache.commons.lang3.StringUtils@isNotBlank(simpleCondition.searchWord)">
				OR LOWER(INCUM_NAME) LIKE '%' || #{simpleCondition.searchWord} || '%'
			</if>
			<if test="simpleCondition neq null and @org.apache.commons.lang3.StringUtils@isNotBlank(simpleCondition.searchWord)">
				OR LOWER(DEPARTMENT) LIKE '%' || #{simpleCondition.searchWord} || '%'
			</if>
			<if test="simpleCondition neq null and @org.apache.commons.lang3.StringUtils@isNotBlank(simpleCondition.searchWord)">
				OR LOWER(CMP_ID) LIKE '%' || #{simpleCondition.searchWord} || '%'
			</if>
		</trim>
	</sql>

	<select id="selectInterview" parameterType="String" resultType="kr.or.ddit.board.vo.InterviewVO">
		SELECT INCUM_NO,
			   CMP_ID,
			   JOB_NAME,
			   INCUM_TITLE,
			   INCUM_CONTENT,
			   INCUM_NAME,
			   TO_CHAR(INCUM_DATE,'YYYY-MM-DD') INCUM_DATE,
			   INCUM_HITS,
			   DEPARTMENT,
			   SUBTITLE,
			   INCUM_DEL_DATE
		  FROM INCUM_INTERVIEW
		 WHERE INCUM_NO = #{incumNo}
		   AND INCUM_DEL_DATE IS NULL
	</select>

	<select id="selectTotalRecord" parameterType="PagingVO" resultType="int">
		SELECT COUNT(*)
		  FROM INCUM_INTERVIEW
	<include refid="searchFrag"/>
	</select>

	<select id="selectInterviewList" resultType="kr.or.ddit.board.vo.InterviewVO">
          WITH ORDEREDINTERVIEW AS(
		SELECT INCUM_NO,
			   CMP_ID,
			   JOB_NAME,
			   INCUM_TITLE,
			   INCUM_CONTENT,
			   INCUM_NAME,
			   TO_CHAR(INCUM_DATE,'YYYY-MM-DD') INCUM_DATE,
			   INCUM_HITS,
			   DEPARTMENT,
			   SUBTITLE
		  FROM (SELECT *
				  FROM INCUM_INTERVIEW
       			 WHERE INCUM_DEL_DATE IS NULL)
	<include refid="searchFrag"/>
	  ORDER BY INCUM_NO DESC
	  ) SELECT A.*
	      FROM (
	      	SELECT ROWNUM RNUM, ORDEREDINTERVIEW.*
	      	  FROM ORDEREDINTERVIEW
	      ) A
	      <where>
	      	<if test="_parameter neq null">
	      		RNUM BETWEEN #{startRow} AND #{endRow}
	      	</if>
	      </where>
	</select>

	<insert id="insertInterview" parameterType="InterviewVO">
		<selectKey order="BEFORE" resultType="String" keyProperty="incumNo">
			SELECT 'INT'||LPAD(INTERVIEW_SEQ.NEXTVAL, 6, 0)
			  FROM DUAL
		</selectKey>
		INSERT INTO INCUM_INTERVIEW(
			  DEPARTMENT
			, INCUM_NO
			, CMP_ID
			, JOB_NAME
			, INCUM_TITLE
			, INCUM_CONTENT
			, INCUM_NAME
			, INCUM_DATE
			, INCUM_HITS
			, SUBTITLE
		)VALUES(
			  #{department,jdbcType=VARCHAR}
			, #{incumNo,jdbcType=VARCHAR}
			, #{cmpId,jdbcType=VARCHAR}
			, #{jobName,jdbcType=VARCHAR}
			, #{incumTitle,jdbcType=VARCHAR}
			, #{incumContent,jdbcType=CLOB}
			, #{incumName,jdbcType=VARCHAR}
			, SYSDATE
			, 0
			, #{subTitle,jdbcType=VARCHAR}
		)
	</insert>

	<update id="updateInterview" parameterType="InterviewVO">
		UPDATE INCUM_INTERVIEW
		   SET
			     JOB_NAME 	   = #{jobName,jdbcType=VARCHAR}
			   , INCUM_TITLE   = #{incumTitle,jdbcType=VARCHAR}
			   , INCUM_CONTENT = #{incumContent,jdbcType=CLOB}
			   , INCUM_NAME    = #{incumName,jdbcType=VARCHAR}
			   , SUBTITLE      = #{subTitle,jdbcType=VARCHAR}
			   , DEPARTMENT    = #{department,jdbcType=VARCHAR}
		 WHERE INCUM_NO        = #{incumNo,jdbcType=VARCHAR}
	</update>

	<delete id="deleteInterview" parameterType="InterviewVO">
		UPDATE INCUM_INTERVIEW
		   SET INCUM_DEL_DATE = SYSDATE
		 WHERE INCUM_NO       = #{incumNo, jdbcType=VARCHAR}
	</delete>

	<update id="updateHits" parameterType="String">
		UPDATE INCUM_INTERVIEW
		   SET INCUM_HITS = INCUM_HITS+1
		 WHERE INCUM_NO   = #{incumNo, jdbcType=VARCHAR}
	</update>

</mapper>

