<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.selfpr.dao.SelfprDAO">
	
	<!-- dropdown box 선택값 -->
	
	<select id="selectRegionList" resultType="hashmap">
		SELECT REGION_CODE "regionCode", REGION_NAME "regionName", REGION_REF "regionRef" 
		FROM CD_REGION
		<where>
			<choose>
				<when test="@org.apache.commons.lang3.StringUtils@isNotBlank(regionRef)">
					REGION_REF = #{regionRef}
				</when>
				<otherwise>
					REGION_REF IS NULL
				</otherwise>
			</choose>
		</where>
		ORDER BY 1
	</select>
	<select id="selectIndustry" resultType="hashmap">
		SELECT INDUSTRY_CODE "industryCode", INDUSTRY_NAME "industryName", INDUSTRY_REF "industryRef" 
		FROM CD_INDUSTRY
		<where>
			<choose>
				<when test="@org.apache.commons.lang3.StringUtils@isNotBlank(industryRef)">
					INDUSTRY_REF = #{industryRef}
				</when>
				<otherwise>
					INDUSTRY_REF IS NULL
				</otherwise>
			</choose>
		</where>
		ORDER BY 1
	</select>
	
	<!-- 검색 -->
	<sql id="searchFrag">
		<trim prefix="WHERE">
			 1 = 1
		    <if test="detailCondition neq null">
<!-- 		    	<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(detailCondition.industry1)"> -->
<!-- 		    		AND INDUSTRY_CODE = #{detailCondition.industry1} -->
<!-- 		    	</if> -->
<!-- 		    	<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(detailCondition.regionCode)"> -->
<!-- 		    		AND REGION_CODE = #{detailCondition.regionCode} -->
<!-- 		    	</if> -->
		    AND (PR_ANNUAL LIKE '%' || #{detailCondition.prAnnual} || '%'
	    	AND	PR_WANTTYPE LIKE '%' || #{detailCondition.prWanttype} || '%'
    		AND PR_EDU LIKE '%' || #{detailCondition.prEdu} || '%' 
    		AND	REGION_CODE LIKE '%' || #{detailCondition.regionCode} || '%'
    		AND	INDUSTRY_CODE LIKE '%' || #{detailCondition.industry1} || '%')
		    </if>
	    </trim>
	</sql>
	
	<!-- 전체 글 조회 -->
	
	<select id="selectSelfprList" parameterType="PagingVO" resultType="kr.or.ddit.selfpr.vo.SelfprVO">
		WITH ORDEREDSELFPR AS (
		    SELECT A.MEM_ID, A.PR_NO, A.PR_NAME, A.PR_CONTENT, A.PR_WANTJOB, A.PR_ANNUAL, A.PR_WANTMN, A.PR_WANTTYPE,
               B.MEM_NAME
            FROM PR A
            INNER JOIN MEMBER B ON (A.MEM_ID = B.MEM_ID)
            <include refid="searchFrag"></include>           
		    ORDER BY PR_NO DESC
		)
		SELECT A.*
		FROM (
		    SELECT ROWNUM RNUM, ORDEREDSELFPR.*
		    FROM ORDEREDSELFPR
		) A
		WHERE RNUM BETWEEN #{startRow} AND #{endRow} 
	</select>	
	
	<select id="selectTotalRecord" parameterType="PagingVO" resultType="int">
		SELECT COUNT(*)
		FROM PR
<!-- 		<include refid="searchFrag"/>  -->
	</select>
	
	<!-- detail 개인정보 가져오는 쿼리 -->
	<select id="selectSelfprMember" parameterType="int" resultType="SelfprVO">
		SELECT A.MEM_ID, A.PR_NO, A.PR_NAME, A.PR_CONTENT, A.PR_WANTJOB, A.PR_ANNUAL, A.PR_WANTMN, A.PR_WANTTYPE, A.REGION_CODE, A.INDUSTRY_CODE,
		       B.MEM_NAME,
		       C.MEM_GENDER, C.MEM_EMAIL, C.MEM_TEL, C.MEM_ADDR1
		FROM PR A
		INNER JOIN MEMBER B ON (A.MEM_ID = B.MEM_ID)
		INNER JOIN SEEKER C ON (B.MEM_ID = C.MEM_ID)
		WHERE PR_NO = #{prNo}
	</select>
	
	<!-- detail 학력 가져오는 쿼리 -->
	<select id="selectSelfprEducation" parameterType="int" resultType="SelfprVO">
		SELECT PR_NO,
		       B.EDU_NAME, B.EDU_DEPARTMENT, B.EDU_MAJOR, B.EDU_STATUS, B.EDU_SCORE, B.EDU_ENTERED, B.EDU_GRADUATED
		FROM PR A
		INNER JOIN EDUCATION B ON (A.MEM_ID = B.MEM_ID)
		WHERE PR_NO = #{prNo}
	</select>
	
<!-- 	<insert id="insertNews" parameterType="NewsVO"> -->
<!-- 		<selectKey order="BEFORE" resultType="int" keyProperty="newsNo"> -->
<!-- 			SELECT NEWS_SEQ.NEXTVAL -->
<!-- 			FROM DUAL -->
<!-- 		</selectKey> -->
<!-- 		INSERT INTO NEWS ( -->
<!-- 		    NEWS_NO, -->
<!-- 		    NEWS_NAME, -->
<!-- 		    NEWS_DATE, -->
<!-- 		    NEWS_FIELD, -->
<!-- 		    NEWS_HIT, -->
<!-- 		    NEWS_CONTENT, -->
<!-- 		    MEM_ID -->
<!-- 		) VALUES ( -->
<!-- 			#{newsNo,jdbcType=NUMERIC} -->
<!-- 			, #{newsName,jdbcType=VARCHAR} -->
<!-- 			, SYSDATE -->
<!-- 			, #{newsField,jdbcType=VARCHAR} -->
<!-- 			, #{newsHit,jdbcType=NUMERIC} -->
<!-- 			, #{newsContent,jdbcType=VARCHAR} -->
<!-- 			, #{memId,jdbcType=VARCHAR} -->
<!-- 		) -->
<!-- 	</insert> -->
	
<!-- 	<update id="incrementHit" parameterType="int"> -->
<!-- 		UPDATE NEWS -->
<!-- 		SET -->
<!-- 		NEWS_HIT = NEWS_HIT + 1 -->
<!-- 		WHERE NEWS_NO = #{newsNo} -->
<!-- 	</update> -->
	
<!-- 	<update id="updateNews" parameterType="NewsVO"> -->
<!-- 		UPDATE NEWS -->
<!-- 		SET -->
<!-- 		    NEWS_NAME = #{newsName,jdbcType=VARCHAR} -->
<!-- 		    , NEWS_FIELD = #{newsField,jdbcType=VARCHAR} -->
<!-- 		    , NEWS_CONTENT = #{newsContent,jdbcType=VARCHAR} -->
<!-- 		WHERE NEWS_NO = #{newsNo} -->
<!-- 	</update> -->
	
<!-- 	<delete id="deleteNews" parameterType="int"> -->
<!-- 		DELETE  -->
<!-- 		FROM NEWS -->
<!-- 		WHERE NEWS_NO = #{newsNo} -->
<!-- 	</delete> -->
	
</mapper>