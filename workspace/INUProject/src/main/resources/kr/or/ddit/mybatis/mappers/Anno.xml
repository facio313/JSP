<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.announcement.dao.AnnoDAO">

	<select id="selectTotalRecord" parameterType="PagingVO" resultType="int">
		SELECT COUNT(*)
		FROM ANNO
	</select>
	
	<!-- 기업정보 추가하기 -->
	<select id="selectAnnoList" parameterType="PagingVO" resultType="AnnoVO">
		WITH ANNOBOARD AS(
		    SELECT ANNO_NO,CMP_ID,ANNO_TITLE,ANNO_CONTENT
		            ,ANNO_STARTDATE,ANNO_ENDDATE,ANNO_HIT,ANNO_DATE
		            ,ANNO_STATE_CD,ANNO_SALARY,INDUSTRY_CODE,EDU_CODE
		    FROM ANNO
		    WHERE ANNO_STATE_CD='B1'
		    ORDER BY ANNO_NO DESC
		) 
		SELECT A.*
		FROM(
		    SELECT ROWNUM RNUM, ANNOBOARD.*
		    FROM ANNOBOARD
		) A
		WHERE RNUM BETWEEN #{startRow} AND #{endRow}
	</select>


	<!-- 기업정보 추가하기 -->
	<resultMap type="AnnoVO" id="annoMap" autoMapping="true">
		<id property="annoNo" column="ANNO_NO" />
		<collection property="detailList" ofType="AnnoDetailVO" autoMapping="true">
			<id property="daNo" column="DA_NO" />
			<collection property="careerName" ofType="string"></collection>
			<collection property="positionName" ofType="string"></collection>
		</collection>
		<collection property="walfareList" ofType="AnnoWalfareVO" autoMapping="true">
			<id property="annowalNo" column="ANNOWAL_NO" />
		</collection>
	</resultMap>
	<select id="selectAnno" parameterType="string" resultMap="annoMap">
		WITH ANNODETAIL AS (
		    SELECT D.DA_NO, D.ANNO_NO, D.DA_FD, D.DA_COUNT
		        , D.DA_TASK, D.DA_DEPARTMENT, D.DA_CONDITION
		        , D.DA_PREFER, D.DA_WORKDAY, D.DA_WORKTIME
		        , D.DA_CAR_YEER, D.REGION_CODE, D.EMPLTYPE_CODE, D.JOB_CODE
		        , AC.CAREER_NAME
		        , (SELECT POSITION_NAME FROM CD_POSITION WHERE POSITION_CODE=AP.POSITION_CODE) POSITION_NAME
		        , (SELECT REGION_NAME FROM CD_REGION WHERE CD_REGION.REGION_CODE=D.REGION_CODE) REGION_NAME
		        , (SELECT JOB_NAME FROM CD_JOB WHERE CD_JOB.JOB_CODE=D.JOB_CODE) JOB_NAME
		        , (SELECT EMPLTYPE_NAME FROM CD_EMPLTYPE WHERE CD_EMPLTYPE.EMPLTYPE_CODE=D.EMPLTYPE_CODE) EMPLTYPE_NAME
		    FROM ANNO_DETAIL D LEFT OUTER JOIN ANNO_CAREER AC ON (D.DA_NO = AC.DA_NO)
		        LEFT OUTER JOIN ANNO_POSITION AP ON (D.DA_NO = AP.DA_NO)
		),
		ANNOALL AS(
		    SELECT A.ANNO_NO, A.CMP_ID, A.MEM_ID
		        , A.ANNO_TITLE, A.ANNO_CONTENT, A.ANNO_STARTDATE
		        , A.ANNO_ENDDATE, A.ANNO_HIT, A.ANNO_DATE
		        , A.ANNO_STATE_CD, A.ANNO_WORKENV, A.ANNO_PROBATION
		        , A.ANNO_SALARY, A.ATT_ID, INDUSTRY_CODE
		        , (SELECT INDUSTRY_NAME FROM CD_INDUSTRY WHERE CD_INDUSTRY.INDUSTRY_CODE=A.INDUSTRY_CODE) INDUSTRY_NAME
		        , A.EDU_CODE
		        , (SELECT EDU_NAME FROM CD_EDUCATION WHERE CD_EDUCATION.EDU_CODE=A.EDU_CODE) EDU_NAME
		        , AW.ANNOWAL_NO, AW.WALFARE_CODE, CW.WALFARE_NAME, CW.WALFARE_REF REF_CODE
		        , (SELECT WALFARE_NAME FROM CD_WALFARE WHERE WALFARE_CODE = CW.WALFARE_REF) REF_NAME
		    FROM ANNO A LEFT OUTER JOIN ANNO_WALFARE AW ON (A.ANNO_NO = AW.ANNO_NO)
		        INNER JOIN CD_WALFARE CW ON (AW.WALFARE_CODE = CW.WALFARE_CODE)
		)
		SELECT ANNODETAIL.*, ANNOALL.*
		FROM ANNOALL LEFT OUTER JOIN ANNODETAIL ON (ANNOALL.ANNO_NO = ANNODETAIL.ANNO_NO)
		WHERE ANNOALL.ANNO_NO = #{annoNo}
		ORDER BY DA_NO, WALFARE_CODE
	</select>
</mapper>