<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.company.dao.CompanyDAO">

<sql id="searchFrag">
	<where>
		<if test="simpleCondition neq null and @org.apache.commons.lang3.StringUtils@isNotBlank(simpleCondition.searchWord)">
			INSTR(CMP_NAME, #{simpleCondition.searchWord}) > 0 		
		</if>
	</where>
</sql>
	
<select id="selectTotalRecord" parameterType="PagingVO" resultType="int">
	select count(*)
	from company
	<include refid="searchFrag"/>
</select>	

<select id="selectCompanyList" parameterType="PagingVO" resultType="kr.or.ddit.company.vo.CompanyVO">
	WITH ORDEREDCOMPANY AS (
		SELECT CMP_ID, CMP_NO, CMP_NAME, CMP_REP_NAME, CMP_BSNS_NO, CMP_ADDR1, CMP_ADDR2, CMP_ZIP, CMP_PHONE, CMP_EMAIL, CMP_URL, CMP_ESTBL_DATE, CMP_SMENP, CMP_EMP_NO, CMP_AVR_WORK, CMP_AVR_SALARY, CMP_MB_NAME, CMP_CHECK, CMP_CONTENT, CMP_LOGO, ATT_ID
		FROM COMPANY
		<include refid="searchFrag"/>
		ORDER BY CMP_ID DESC
	 )
	 SELECT A.*
	 FROM (
	 	SELECT ROWNUM AS RNUM, ORDEREDCOMPANY.*
	 	FROM ORDEREDCOMPANY
	 	)A
	 WHERE RNUM BETWEEN #{startRow} AND #{endRow}
</select>	
	 
<select id="selectCompany" parameterType="String" resultType="kr.or.ddit.company.vo.CompanyVO">
	select *
	from company
	where 
    <include refid="searchFrag"/>

</select>

<insert id="insertCompany" parameterType="CompanyVO">
	<selectKey order="BEFORE" resultType="string" keyProperty="cmpId">
		SELECT 'CMP' || LPAD(COMPANY_SEQ.NEXTVAL,6,0) FROM DUAL
	</selectKey>
	INSERT INTO COMPANY	
	(
		CMP_ID, 
		CMP_NO, 
		CMP_NAME, 
		CMP_REP_NAME, 
		CMP_BSNS_NO, 
		CMP_ADDR1, 
		CMP_ADDR2, 
		CMP_ZIP, 
		CMP_PHONE, 
		CMP_EMAIL, 
		CMP_URL,
		CMP_ESTBL_DATE, 
		CMP_SMENP, 
		CMP_EMP_NO,
		CMP_AVR_WORK,
		CMP_AVR_SALARY,
		CMP_MB_NAME, 
		CMP_CONTENT
	)VALUES (
		#{cmpId,jdbcType=VARCHAR}
		, #{cmpNo,jdbcType=VARCHAR}
		, #{cmpName,jdbcType=VARCHAR}
		, #{cmpRepName,jdbcType=VARCHAR}
		, #{cmpBsnsNo,jdbcType=VARCHAR}
		, #{cmpAddr1,jdbcType=VARCHAR}
		, #{cmpAddr2,jdbcType=VARCHAR}
		, #{cmpZip,jdbcType=VARCHAR}
		, #{cmpPhone,jdbcType=VARCHAR}
		, #{cmpEmail,jdbcType=VARCHAR}
		, #{cmpUrl,jdbcType=VARCHAR}
		, #{cmpEstblDate,jdbcType=DATE}
		, #{cmpSmenp,jdbcType=VARCHAR}
		, #{cmpEmpNo,jdbcType=VARCHAR}
		, #{cmpAvrWork,jdbcType=VARCHAR}
		, #{cmpAvrSalary,jdbcType=VARCHAR}
		, #{cmpMbName,jdbcType=VARCHAR}
		, #{cmpContent,jdbcType=CLOB}
	)
</insert>


<!-- 시스템 관리 부분 -->
<delete id="deleteAppliCmp" parameterType="CompanyVO">
	DELETE FROM COMPANY
	WHERE CMP_ID = #{cmpId}
</delete>



</mapper>





